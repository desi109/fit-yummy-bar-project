"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const fs_1 = require("fs");
const fs_extra_1 = require("fs-extra");
const path_1 = require("path");
const WEEK_IN_MS = 1000 * 60 * 60 * 24 * 7;
const folder = process.argv[2];
removeOld(terminalOutputs());
removeOld(cachedFiles());
function terminalOutputs() {
    try {
        return fs_1.readdirSync(path_1.join(folder, 'terminalOutputs'));
    }
    catch (e) {
        return [];
    }
}
function cachedFiles() {
    try {
        return fs_1.readdirSync(folder).filter((f) => !f.endsWith('terminalOutputs'));
    }
    catch (e) {
        return [];
    }
}
function removeOld(records) {
    try {
        const time = mostRecentMTime(records);
        records.forEach((r) => {
            const child = path_1.join(folder, r);
            try {
                const s = fs_1.statSync(child);
                if (time - s.mtimeMs > WEEK_IN_MS) {
                    if (s.isDirectory()) {
                        try {
                            fs_extra_1.removeSync(`${child}.commit`);
                        }
                        catch (e) { }
                    }
                    fs_extra_1.removeSync(child);
                }
            }
            catch (e) { }
        });
    }
    catch (e) { }
}
function mostRecentMTime(records) {
    let mostRecentTime = 0;
    records.forEach((r) => {
        const child = path_1.join(folder, r);
        try {
            const s = fs_1.statSync(child);
            if (s.mtimeMs > mostRecentTime) {
                mostRecentTime = s.mtimeMs;
            }
        }
        catch (e) { }
    });
    return mostRecentTime;
}
//# sourceMappingURL=remove-old-cache-records.js.map