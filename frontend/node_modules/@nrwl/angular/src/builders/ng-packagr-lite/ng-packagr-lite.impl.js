"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const architect_1 = require("@angular-devkit/architect");
const ng = require("@angular/compiler-cli");
const path_1 = require("path");
const buildable_libs_utils_1 = require("@nrwl/workspace/src/utils/buildable-libs-utils");
const package_di_1 = require("./ng-packagr-adjustments/package.di");
const ng_packagr_1 = require("ng-packagr");
const entry_point_di_1 = require("./ng-packagr-adjustments/entry-point.di");
const package_impl_1 = require("../package/package.impl");
function initializeNgPackgrLite(options, context, projectDependencies) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        // const packager = (await import('ng-packagr')).ngPackagr();
        const packager = new ng_packagr_1.NgPackagr([
            // Add default providers to this list.
            ...package_di_1.NX_PACKAGE_PROVIDERS,
            ...entry_point_di_1.NX_ENTRY_POINT_PROVIDERS,
        ]);
        packager.forProject(path_1.resolve(context.workspaceRoot, options.project));
        packager.withBuildTransform(package_di_1.NX_PACKAGE_TRANSFORM.provide);
        if (options.tsConfig) {
            // read the tsconfig and modify its path in memory to
            // pass it on to ngpackagr
            const parsedTSConfig = ng.readConfiguration(options.tsConfig);
            buildable_libs_utils_1.updatePaths(projectDependencies, parsedTSConfig.options.paths);
            packager.withTsConfig(parsedTSConfig);
        }
        return packager;
    });
}
exports.default = architect_1.createBuilder(package_impl_1.createLibraryBuilder(initializeNgPackgrLite));
//# sourceMappingURL=ng-packagr-lite.impl.js.map