"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.enableStrictTypeChecking = void 0;
const schematics_1 = require("@angular-devkit/schematics");
const workspace_1 = require("@nrwl/workspace");
/**
 * Enable Strict Mode in the library and spec TS Config
 * */
function enableStrictTypeChecking(options) {
    return () => schematics_1.chain([updateTsConfig(options), updateAngularWorkspace()]);
}
exports.enableStrictTypeChecking = enableStrictTypeChecking;
function updateTsConfig(options) {
    return () => {
        // Update the settings in the tsconfig.app.json to enable strict type checking.
        // This matches the settings defined by the Angular CLI https://angular.io/guide/strict-mode
        return workspace_1.updateJsonInTree(`${options.projectRoot}/tsconfig.json`, (json) => {
            var _a, _b;
            // update the TypeScript settings
            json.compilerOptions = Object.assign(Object.assign({}, ((_a = json.compilerOptions) !== null && _a !== void 0 ? _a : {})), { forceConsistentCasingInFileNames: true, strict: true, noImplicitReturns: true, noFallthroughCasesInSwitch: true });
            // update Angular Template Settings
            json.angularCompilerOptions = Object.assign(Object.assign({}, ((_b = json.angularCompilerOptions) !== null && _b !== void 0 ? _b : {})), { strictInjectionParameters: true, strictTemplates: true });
            return json;
        });
    };
}
function updateAngularWorkspace() {
    // set the default so future libraries will default to strict mode
    // unless the user has previously set this to false by default
    return workspace_1.updateWorkspace((workspace) => {
        var _a;
        workspace.extensions.schematics = workspace.extensions.schematics || {};
        workspace.extensions.schematics['@nrwl/angular:library'] =
            workspace.extensions.schematics['@nrwl/angular:library'] || {};
        workspace.extensions.schematics['@nrwl/angular:library'].strict =
            (_a = workspace.extensions.schematics['@nrwl/angular:library'].strict) !== null && _a !== void 0 ? _a : true;
    });
}
//# sourceMappingURL=enable-strict-type-checking.js.map