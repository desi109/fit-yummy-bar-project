"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.updateNgPackage = void 0;
const schematics_1 = require("@angular-devkit/schematics");
const workspace_1 = require("@nrwl/workspace");
const ast_utils_1 = require("@nrwl/workspace/src/utils/ast-utils");
const devkit_1 = require("@nrwl/devkit");
function updateNgPackage(host, options) {
    if (!(options.publishable || options.buildable)) {
        return schematics_1.noop();
    }
    const dest = `${devkit_1.offsetFromRoot(options.projectRoot)}dist/${ast_utils_1.libsDir(host)}/${options.projectDirectory}`;
    return schematics_1.chain([
        workspace_1.updateJsonInTree(`${options.projectRoot}/ng-package.json`, (json) => {
            let $schema = json.$schema;
            if (json.$schema && json.$schema.indexOf('node_modules') >= 0) {
                $schema = `${devkit_1.offsetFromRoot(options.projectRoot)}${json.$schema.substring(json.$schema.indexOf('node_modules'), json.$schema.length)}`;
            }
            return Object.assign(Object.assign({}, json), { dest,
                $schema });
        }),
    ]);
}
exports.updateNgPackage = updateNgPackage;
//# sourceMappingURL=update-ng-package.js.map