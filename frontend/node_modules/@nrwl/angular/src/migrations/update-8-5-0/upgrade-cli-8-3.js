"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const schematics_1 = require("@angular-devkit/schematics");
const workspace_1 = require("@nrwl/workspace");
const semver_1 = require("semver");
const updateAngular = workspace_1.addUpdateTask('@angular/core', '8.2.4');
function updateCLI() {
    const tasks = [];
    const rule = schematics_1.chain([
        workspace_1.updateJsonInTree('package.json', (json) => {
            json.devDependencies = json.devDependencies || {};
            const cliVersion = json.devDependencies['@angular/cli'];
            const cleanCliVersion = workspace_1.checkAndCleanWithSemver('@angular/cli', cliVersion);
            if (cleanCliVersion && semver_1.gt(cleanCliVersion, '8.3.3')) {
                return json;
            }
            if (json['devDependencies']['@angular/cli']) {
                json['devDependencies']['@angular/cli'] = '^8.3.3';
            }
            if (json['devDependencies']['@angular-devkit/build-angular']) {
                json['devDependencies']['@angular-devkit/build-angular'] = '^0.803.3';
            }
            if (json['devDependencies']['@angular-devkit/build-ng-packagr']) {
                json['devDependencies']['@angular-devkit/build-ng-packagr'] =
                    '~0.803.3';
            }
            return json;
        }),
        workspace_1.addInstallTask(),
    ]);
    return { rule, tasks };
}
function updateNgrx(updateDeps) {
    return (host) => {
        const { dependencies } = workspace_1.readJsonInTree(host, 'package.json');
        if (dependencies && dependencies['@ngrx/store']) {
            return schematics_1.chain([
                workspace_1.addUpdateTask('@ngrx/store', '8.3.0', updateDeps),
                workspace_1.formatFiles(),
            ]);
        }
        return schematics_1.noop();
    };
}
function default_1() {
    const { rule: updateCLIRule, tasks } = updateCLI();
    return schematics_1.chain([
        updateAngular,
        updateCLIRule,
        updateNgrx(tasks),
        workspace_1.formatFiles(),
    ]);
}
exports.default = default_1;
//# sourceMappingURL=upgrade-cli-8-3.js.map