"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const tslib_1 = require("tslib");
const core_1 = require("@angular-devkit/core");
const schematics_1 = require("@angular-devkit/schematics");
const workspace_1 = require("@nrwl/workspace");
const path_1 = require("path");
const devkit_1 = require("@nrwl/devkit");
function updateBaseConfig(project, baseConfig) {
    return workspace_1.updateJsonInTree(baseConfig, (json) => {
        return Object.assign(Object.assign({}, json), { extends: `${devkit_1.offsetFromRoot(project.root)}tsconfig.base.json` });
    });
}
function udpateProtractorTsConfig(host) {
    return tslib_1.__awaiter(this, void 0, void 0, function* () {
        const workspace = yield workspace_1.getWorkspace(host);
        const rules = [];
        workspace.projects.forEach((project) => {
            project.targets.forEach((target) => {
                if (target.builder === '@angular-devkit/build-angular:protractor') {
                    rules.push(updateBaseConfig(project, core_1.normalize(`${project.root}/tsconfig.json`)));
                }
            });
        });
        return schematics_1.chain(rules);
    });
}
function default_1() {
    return schematics_1.chain([
        workspace_1.updatePackagesInPackageJson(path_1.join(__dirname, '../../../migrations.json'), '10.4.0'),
        udpateProtractorTsConfig,
        workspace_1.formatFiles(),
    ]);
}
exports.default = default_1;
//# sourceMappingURL=update-10-4-0.js.map